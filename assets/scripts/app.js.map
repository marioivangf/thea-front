{"version":3,"sources":["functions.js"],"names":["update_form_styles","cont","document","getElementById","v","value","tinycolor","isDark","getBrightness","darken","tmpl","question_templs","style_sheet","Mustache","render","write_styles","classList","toggle","style_id","css_text","style_el","getElementsByTagName","removeChild","createElement","type","id","innerHTML","appendChild","not_responsive_check","w","window","innerWidth","body","each_node_evt","selector","cb","nodes","querySelectorAll","_","each","node","addEventListener","each_node_evt_init_once","length","onetime","callback","e","target","removeEventListener","arguments","callee","serialize_ques_options","children","index","in_reply","querySelector","in_value","name","get_input_image","input","files","reader","FileReader","onload","event","result","readAsDataURL","dataset","pathName","currentTarget","sync_target","syncedInput","trim","console","log","placeholder","parentNode","parentClassToggle","style","display","stopPropagation","parent_clist","state_class","contains","remove","add","image","data","src","element","proxyClick","click","unset","dispatchEvent","Event","med_logo_in","logos_cont","logo","Image","forms","form","preventDefault","endpoint","action","searcher","FormData","qwest","post","then","xhr","response","impostor","backgroundColor","rome","use","moment","start","end","start_cal","time","monthsInCalendar","dateValidator","val","beforeEq","end_cal","afterEq","scrollable_parent","closest","hide","cal","Dropdown","Tagin","path","autocomplete","autoComplete","minChars","source","term","abort","q","max_size","Number","valFilesize","alert","size","setTimeout","woof","woofmark","markdown","html","parseHTML","domador","parseMarkdown","megamark","defaultMode","modes","button","commands","command","icon","Tabule","opts_string","sticker","Sticker","JSON","parse","list","sample","sample_clone","cloneNode","btn","clone","input_data","i","ques","block","child","push","stringify","quests","quests_cont","quests_open","quest_type_sel","option_check","opt","options","selectedIndex","optionsOpen","quest_drake","dragula","removeOnSpill","moves","el","container","handle","sibling","on","Chart","defaults","global","title","gender_chart_dom","chart","getContext","age_chart_dom","patients_chart_dom","questions_source","question_template","questions","question","dragula_containers","drake","copy","accepts","autoScroll","margin","maxSpeed","scrollWhenOutside","this","down","dragging","def","questionDefinition","cancel","definition","exists","visit_block","blockName","rendered","question_tmpl","wrapper","insertBefore","quest_cond","inp","parent","checked"],"mappings":"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","file":"app.js","sourcesContent":["(function () {\n\n  // GLOBALS\n  var path_name = document.body.dataset.pathName;\n\n  // Not responsive validation\n  window.addEventListener('resize', not_responsive_check, true);\n  not_responsive_check();\n\n  // Sync input with else text\n  each_node_evt(\"[data-synced-input]\", \"keyup\", function (event) {\n    var input = event.currentTarget;\n    var sync_target = document.getElementById(input.dataset.syncedInput);\n    var value = input.value.trim();\n    console.log(value);\n    sync_target.classList.toggle(\"clean\", value === \"\")\n    sync_target.innerHTML = (value === \"\") ? input.placeholder : value;\n  });\n\n  // Toggle password in inputs\n  each_node_evt(\"[data-password-toggle]\", \"mousedown\", function (event) {\n    var input = event.currentTarget.parentNode.getElementsByTagName(\"INPUT\")[0];\n    input.type = \"text\";\n  });\n  each_node_evt(\"[data-password-toggle]\", \"mouseup\", function (event) {\n    var input = event.currentTarget.parentNode.getElementsByTagName(\"INPUT\")[0];\n    input.type = \"password\";\n  });\n\n  // Toggle classes in parents\n  each_node_evt(\"[data-parent-class-toggle]\", \"click\", function (event) {\n    var target = event.currentTarget;\n    target.parentNode.classList.toggle(target.dataset.parentClassToggle);\n  });\n\n  // Toggle classes in parents\n  each_node_evt(\"[data-close-parent]\", \"click\", function (event) {\n    var target = event.currentTarget;\n    target.parentNode.style.display = \"none\";\n  });\n\n  // Toggle classes for dropdowns\n  each_node_evt(\"[data-dropdown-toggle]\", \"click\", function (event) {\n    event.stopPropagation();\n    var parent_clist = event.currentTarget.parentNode.classList;\n    var state_class = \"dropdown--opened\";\n    if (parent_clist.contains(state_class))\n      parent_clist.remove(state_class);\n    else {\n      parent_clist.add(state_class);\n      onetime(document, \"click\", function () {\n        parent_clist.remove(state_class);\n      });\n    }\n  });\n\n  // Image inputs with preview\n  each_node_evt(\"[data-image-input] input[type='file']\", \"change\", function (event) {\n\n    var input = event.currentTarget;\n    var image = input.parentNode.querySelector(\"img\");\n\n    if (input.value) {\n      get_input_image(input, function (data) {\n        input.parentNode.classList.remove(\"clean\");\n        image.src = data;\n      });\n    } else {\n      input.parentNode.classList.add(\"clean\");\n      image.src = \"\";\n    }\n  });\n\n  // Image inputs with preview\n  each_node_evt(\"[data-proxy-click]\", \"click\", function (event) {\n    var element = event.currentTarget;\n    document.querySelector(element.dataset.proxyClick).click();\n  });\n\n  // Unset inputs\n  each_node_evt(\"[data-unset]\", \"click\", function (event) {\n    var element = event.currentTarget;\n    var input = document.querySelector(element.dataset.unset);\n    input.value = \"\";\n    input.dispatchEvent(new Event(\"change\"));\n  });\n\n  // Med logo in form construction\n  var med_logo_in = document.getElementById(\"med-logo-in\");\n  if (med_logo_in) {\n    var logos_cont = document.getElementById(\"af-logos\");\n    med_logo_in.addEventListener(\"change\", function () {\n      var logo = document.getElementById(\"med-logo\");\n      if (logo) logo.parentNode.removeChild(logo);\n      if (med_logo_in.value) {\n        get_input_image(med_logo_in, function (data) {\n          var image = new Image();\n          image.id = \"med-logo\";\n          image.src = data;\n          logos_cont.appendChild(image);\n        });\n      }\n    });\n  }\n\n  // Requests init\n  var forms = document.querySelectorAll(\"[data-searcher]\");\n  _(forms).each(function (form) {\n    form.addEventListener(\"submit\", function (event) {\n      event.preventDefault();\n      var endpoint = form.action;\n      var target = form.dataset.searcher;\n      var data = new FormData(form);\n      qwest.post(endpoint, data).then(function(xhr, response) {\n        document.getElementById(target).innerHTML = response;\n      });\n    });\n  });\n\n  // Color inputs\n  _(document.querySelectorAll(\"[data-input-color]\")).each(function (node) {\n    var input = node.querySelector(\"[data-input]\");\n    var impostor = node.querySelector(\"[data-impostor]\");\n    input.addEventListener(\"change\", function (event) {\n      impostor.style.backgroundColor = input.value;\n    }, false);\n    impostor.style.backgroundColor = input.value;\n  });\n\n  // Rome caledar inititalization\n  _(document.querySelectorAll(\"[data-calendar-range]\")).each(function (node) {\n\n    rome.use(moment);\n    var start = node.querySelector(\"[data-calendar-range-start]\");\n    var end = node.querySelector(\"[data-calendar-range-end]\");\n    var start_cal = rome(start, {\n      time: false,\n      monthsInCalendar: 2,\n      dateValidator: rome.val.beforeEq(end)\n    });\n    var end_cal = rome(end, {\n      time: false,\n      monthsInCalendar: 2,\n      dateValidator: rome.val.afterEq(start)\n    });\n    var scrollable_parent = node.closest(\".scrollable\");\n    if (scrollable_parent) {\n      scrollable_parent.addEventListener(\"scroll\", function() {\n        start_cal.hide();\n        end_cal.hide();\n      });\n    }\n    window.addEventListener(\"scroll\", function() {\n      start_cal.hide();\n      end_cal.hide();\n    });\n  });\n\n  _(document.querySelectorAll(\"[data-date-input]\")).each(function (node) {\n    rome.use(moment);\n    var cal = rome(node, {\n      time: false\n    });\n    var scrollable_parent = node.closest(\".scrollable\");\n    if (scrollable_parent) {\n      scrollable_parent.addEventListener(\"scroll\", function() {\n        cal.hide();\n      });\n    }\n    window.addEventListener(\"scroll\", function() {\n      cal.hide();\n    });\n  });\n\n  // Dropdown inititalization\n  _(document.querySelectorAll(\"[data-dd]\")).each(function (node) {\n    new Dropdown(node);\n  });\n\n  // Tagin inititalization\n  _(document.querySelectorAll(\"[data-tagin]\")).each(function (node) {\n    new Tagin(node);\n  });\n\n  // Autocomplete inititalization\n  _(document.querySelectorAll(\"[data-autocomplete]\")).each(function (node) {\n    var xhr;\n    var path = node.dataset.autocomplete;\n    new autoComplete({\n      selector: node,\n      minChars: 2,\n      source: function (term, response) {\n        try { xhr.abort(); } catch (e) {}\n        qwest.post(path, { q: term }).then(function(xhr, data) {\n          response(data);\n        });\n      }\n    });\n  });\n\n  // Validations\n  _(document.querySelectorAll(\"[data-val-filesize]\")).each(function (node) {\n\n    node.addEventListener(\"change\", function (event) {\n\n      var value = node.value;\n      var max_size = Number(node.dataset.valFilesize);\n\n      if (!window.FormData) alert(\"Por favor actualiza tu navegador\");\n      var files = node.files;\n      if (files.length === 0) return true;\n      if (files.length != 1  || files[0].size <= max_size * 1024 * 1024) return true\n      else {\n        alert(\"El archivo no debe exceder \"+ max_size +\" MB de tamaño.\");\n        setTimeout(function () {\n          node.value = \"\";\n          node.dispatchEvent(new Event(\"change\"));\n        }, 1);\n      }\n    });\n  });\n\n  // Woofmark inititalization\n  _(document.querySelectorAll(\"[data-woofmark]\")).each(function (node) {\n    var woof = woofmark(node, {\n      markdown: false,\n      html: false,\n      parseHTML: domador,\n      parseMarkdown: megamark,\n      defaultMode: \"wysiwyg\",\n      render: {\n        modes: function (button, id) { return false; },\n        commands: function (command, id) {\n          if (id === \"code\" || id === \"image\") {\n            command.style.display = \"none\";\n            return false;\n          }\n          var icon = \"\";\n          switch(id) {\n            case \"bold\":\n              icon = \"&#xE238;\"; break;\n            case \"italic\":\n              icon = \"&#xE23F;\"; break;\n            case \"quote\":\n              icon = \"&#xE244;\"; break;\n            case \"ol\":\n              icon = \"&#xE242;\"; break;\n            case \"ul\":\n              icon = \"&#xE241;\"; break;\n            case \"heading\":\n              icon = \"&#xE245;\"; break;\n            case \"link\":\n              icon = \"&#xE250;\"; break;\n          }\n          command.innerHTML = '<i class=\"material-icons\">'+icon+'</i>';\n        }\n      }\n    });\n    var form = node.form;\n    form.addEventListener(\"submit\", function () {\n      node.value = woof.value();\n    });\n  });\n\n  // Tabule inititalization\n  _(document.querySelectorAll(\"[data-tabule]\")).each(function (node) {\n    new Tabule(node);\n  });\n\n  // Sticker JS init\n  _(document.querySelectorAll(\"[data-sticker]\")).each(function (node) {\n    var opts_string = node.dataset.sticker || \"{}\";\n    new Sticker(node, JSON.parse(opts_string));\n  });\n\n  // Adder for question options\n  _(document.querySelectorAll(\"[data-adder]\")).each(function (node) {\n    var list = node.querySelector(\"[data-adder-list]\");\n    var sample = node.querySelector(\"[data-adder-sample]\");\n    var sample_clone = sample.cloneNode(true);\n    var btn = node.querySelector(\"[data-adder-button]\");\n    btn.addEventListener(\"click\", function () {\n      var clone = sample_clone.cloneNode(true);\n      list.appendChild(clone);\n      serialize_ques_options();\n    });\n  });\n\n  // Form construction submit\n  var form = document.getElementById(\"formulary-form\");\n  if (form) {\n    var input_data = document.getElementById(\"form-data\");\n    form.addEventListener(\"submit\", function (event) {\n      // event.preventDefault();\n      var data = [];\n      for (var i = 1; i <= 4; i++) {\n        var ques = [];\n        var block = document.getElementById(\"visit-block-\"+i);\n        _(block.children).each(function (child) {\n          ques.push(child.dataset.id);\n        });\n        data.push(ques);\n      }\n      input_data.value = JSON.stringify(data);\n    });\n  }\n\n  // Questions creation init\n  var quests = document.getElementById(\"question-options\");\n  if (quests) {\n    var quests_cont = document.getElementById(\"quest-options-cont\");\n    var quests_open = document.getElementById(\"quest-options-open\");\n    var quest_type_sel = document.getElementById(\"quest-type\");\n    var option_check = function () {\n      var opt = quest_type_sel.options[quest_type_sel.selectedIndex];\n      quests_cont.style.display = opt.dataset.options ? \"block\" : \"none\";\n      quests_open.style.display = opt.dataset.optionsOpen ? \"block\" : \"none\";\n    };\n    quest_type_sel.addEventListener(\"change\", option_check);\n    option_check();\n    var quest_drake = dragula([quests], {\n      removeOnSpill: true,\n      moves: function (el, container, handle, sibling) {\n        if (container.children.length < 2) return false;\n        return handle.classList.contains(\"drag-handle\");\n      }\n    });\n    quest_drake.on(\"dragend\", function (el) {\n      serialize_ques_options();\n    });\n  }\n\n  // Forms Statistics\n  Chart.defaults.global.title.display = true;\n  // Gender Pie Chart\n  var gender_chart_dom = document.getElementById(\"pie-chart\");\n  if (gender_chart_dom) {\n    var data = JSON.parse(gender_chart_dom.dataset.chart);\n    var gender_chart = new Chart(gender_chart_dom.getContext('2d'), data);\n  }\n\n  var age_chart_dom = document.getElementById('age-chart');\n  if (age_chart_dom) {\n    var data = JSON.parse(age_chart_dom.dataset.chart);\n    var age_chart = new Chart(age_chart_dom.getContext('2d'), data);\n  }\n\n  var patients_chart_dom = document.getElementById('patients-chart');\n  if (patients_chart_dom) {\n    var data = JSON.parse(patients_chart_dom.dataset.chart);\n    var patients_chart = new Chart(patients_chart_dom.getContext('2d'), data);\n  }\n\n  // Dragula on forms construction\n  var questions_source = document.getElementById(\"questions-source\");\n\n  if (questions_source) {\n\n    var question_template = document.getElementById(\"quest-tmpl\").innerHTML;\n    Mustache.parse(question_template, [\"<%\", \"%>\"]);\n    var questions = [\"number\", \"select\", \"multiple\", \"scale\", \"yes-no\", \"radio\", \"osdi\", \"pain\", \"oxford\", \"yes-no-open\", \"radio-open\", \"styles\"];\n    var question_templs = {};\n    _(questions).each(function (question) {\n      var tmpl = document.getElementById(question+\"-quest-tmpl\").innerHTML;\n      question_templs[question] = tmpl;\n      Mustache.parse(question_templs[question], [\"<%\", \"%>\"]);\n    });\n\n    var dragula_containers = [questions_source];\n    for (var i = 1; i < 5; i++) {\n      var block = document.getElementById(\"visit-block-\"+i);\n      dragula_containers.push(block);\n    }\n\n    var drake = dragula(dragula_containers, {\n      removeOnSpill: true,\n      copy: function (el, source) {\n        return source.id === \"questions-source\";\n      },\n      accepts: function (el, target) {\n        return target.id !== \"questions-source\";\n      },\n      moves: function (el, container, handle) {\n        if (container.id === \"questions-source\")\n          return true;\n        return handle.classList.contains(\"drag-handle\");\n      }\n    });\n\n    // Auto scroll\n    var scroll = autoScroll([window],{\n      margin: 20,\n      maxSpeed: 5,\n      scrollWhenOutside: true,\n      autoScroll: function(){\n        //Only scroll when the pointer is down, and there is a child being dragged.\n        return this.down && drake.dragging;\n      }\n    });\n\n    drake.on(\"drop\", function (element, container, src, sibling) {\n      // Get definition\n      var def = element.dataset.questionDefinition;\n      // Render question\n      drake.cancel(true);\n      var definition = JSON.parse(def);\n      // Validate if question already in block\n      var exists = container.querySelectorAll('[data-id=\"'+definition.id+'\"]');\n      if (container !== src && exists.length > 0) {\n        alert(\"Esta pregunta ya existe para esta visita\");\n      } else {\n        // Else do render\n        if (!element.classList.contains(\"js-source\"))\n          element.remove();\n        definition.visit_block = container.dataset.blockName;\n        definition.definition = def;\n        var tmpl = question_templs[definition.type];\n        var rendered = Mustache.render(question_template, definition, { question_tmpl: tmpl });\n        var wrapper= document.createElement(\"div\");\n        wrapper.innerHTML = rendered;\n        container.insertBefore(wrapper.children[0], sibling);\n      }\n    });\n  }\n\n  window.quest_cond = function (inp, value) {\n    var parent = inp.closest(\"[data-quest-conditional]\");\n    var target = parent.querySelector(\"[data-quest-target]\");\n    target.classList.toggle(\"show\", (inp.checked && inp.value === value));\n  };\n\n  function update_form_styles () {\n\n    var cont = document.getElementById(\"af-container\");\n    // Get color values\n    var v = {};\n    v[\"bg\"] = document.getElementById(\"af-bg-color\").value;\n    v[\"accent\"] = document.getElementById(\"af-accent-color\").value;\n    // Calc colors\n    v[\"text\"] = tinycolor(v[\"bg\"]).isDark() ? \"white\" : \"rgba(0, 0, 0, 0.8)\";\n    v[\"input_bg\"] = (tinycolor(v[\"bg\"]).getBrightness() > 246) ? \"#ECECEC\" : \"white\";\n    v[\"accent_darken\"] = tinycolor(v[\"accent\"]).darken(5);\n    v[\"accent_text\"] = tinycolor(v[\"accent_darken\"]).isDark() ? \"white\" : \"rgba(0, 0, 0, 0.8)\";\n    // Set template\n    var tmpl = question_templs[\"styles\"];\n    var style_sheet = Mustache.render(tmpl, v);\n    write_styles(\"af-styles\", style_sheet);\n    // Change controls accordingly\n    cont.classList.toggle(\"af--dark\", tinycolor(v[\"bg\"]).isDark());\n  }\n\n  // Write styles directly for form customization\n  function write_styles (style_id, css_text) {\n    var style_el = document.getElementById(style_id);\n    if (style_el) document.getElementsByTagName(\"head\")[0].removeChild(style_el);\n    style_el = document.createElement('style');\n    style_el.type = \"text/css\";\n    style_el.id = style_id;\n    style_el.innerHTML = css_text;\n    document.getElementsByTagName(\"head\")[0].appendChild(style_el);\n  }\n\n  // Form styles update\n  each_node_evt_init_once(\"[data-appform-style-trigger]\", \"change\", update_form_styles);\n\n  function not_responsive_check () {\n    var w = window.innerWidth;\n    document.body.classList.toggle(\"not-responsive-notice\", w < 980);\n  }\n\n  function each_node_evt (selector, type, cb) {\n    var nodes = document.querySelectorAll(selector);\n    _(nodes).each(function (node) {\n      node.addEventListener(type, cb);\n    });\n  }\n\n  function each_node_evt_init (selector, type, cb) {\n    var nodes = document.querySelectorAll(selector);\n    _(nodes).each(function (node) {\n      node.addEventListener(type, cb);\n      cb();\n    });\n  }\n\n  function each_node_evt_init_once (selector, type, cb) {\n    var nodes = document.querySelectorAll(selector);\n    _(nodes).each(function (node) {\n      node.addEventListener(type, cb);\n    });\n    if (nodes.length > 0) cb();\n  }\n\n  function onetime (node, type, callback) {\n    // create event\n    node.addEventListener(type, function (e) {\n      // remove event\n      e.target.removeEventListener(e.type, arguments.callee);\n      // call handler\n      return callback(e);\n    });\n  }\n\n  function nodes_to_arr (nodes) {\n    return Array.prototype.slice.call(nodes);\n  }\n\n  function serialize_ques_options () {\n    var cont = document.getElementById(\"question-options\");\n    _(cont.children).each(function (node, index) {\n      var in_reply = node.querySelector(\"[data-reply]\");\n      var in_value = node.querySelector(\"[data-value]\");\n      in_reply.name = in_reply.id =\"id_form-\"+index+\"-reply\";\n      in_value.name = in_value.id =\"id_form-\"+index+\"-value\";\n    });\n  }\n\n  function get_input_image (input, cb) {\n    if (input.files && input.files[0]) {\n      var reader = new FileReader();\n      reader.onload = function (event) {\n        cb(event.target.result);\n      }\n      reader.readAsDataURL(input.files[0]);\n    } else return false;\n  }\n\n})();"]}